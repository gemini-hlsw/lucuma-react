// Copyright (c) 2016-2025 Association of Universities for Research in Astronomy, Inc. (AURA)
// For license information see LICENSE or https://opensource.org/licenses/BSD-3-Clause

package lucuma.react.highcharts

import japgolly.scalajs.react.Reusable
import japgolly.scalajs.react.test.*
import lucuma.typed.highcharts.mod as Highcharts
import utest.*

class ChartTest extends TestSuite {
  val tests = Tests {
    test("render") {
      val chart = Chart(Reusable.always(Highcharts.defaultOptions))
      ReactTestUtils2.withRendered(chart.toUnmounted) { m =>
        val html           = m.outerHTML()
        val normalizedHTML =
          html
            .replaceAll(" id=\"highcharts-\\w{7}-\\d-?\"", "")
            .replaceAll(
              "Created with Highcharts \\d+\\.\\d+\\.\\d+",
              "Created with Highcharts x.y.z"
            )

        assert(
          normalizedHTML == """<div data-highcharts-chart="0" style="overflow: hidden;" aria-hidden="false" role="region" aria-label="Chart title. Highcharts interactive chart."><div id="highcharts-screen-reader-region-before-0" style="position: relative;" aria-hidden="false"><div style="position: absolute; width: 1px; height: 1px; overflow: hidden; white-space: nowrap; clip: rect(1px, 1px, 1px, 1px); margin-top: -3px; filter: alpha(opacity=1); opacity: 0.01;" aria-hidden="false"><h6>Chart title</h6><div>Empty chart</div></div></div><div aria-hidden="false" class="highcharts-announcer-container" style="position: relative;"><div aria-hidden="false" aria-live="polite" aria-atomic="true" style="position: absolute; width: 1px; height: 1px; overflow: hidden; white-space: nowrap; clip: rect(1px, 1px, 1px, 1px); margin-top: -3px; filter: alpha(opacity=1); opacity: 0.01;"></div><div aria-hidden="false" aria-live="assertive" aria-atomic="true" style="position: absolute; width: 1px; height: 1px; overflow: hidden; white-space: nowrap; clip: rect(1px, 1px, 1px, 1px); margin-top: -3px; filter: alpha(opacity=1); opacity: 0.01;"></div><div aria-hidden="false" aria-live="polite" aria-atomic="true" style="position: absolute; width: 1px; height: 1px; overflow: hidden; white-space: nowrap; clip: rect(1px, 1px, 1px, 1px); margin-top: -3px; filter: alpha(opacity=1); opacity: 0.01;"></div><div aria-hidden="false" aria-live="polite" aria-atomic="true" style="position: absolute; width: 1px; height: 1px; overflow: hidden; white-space: nowrap; clip: rect(1px, 1px, 1px, 1px); margin-top: -3px; filter: alpha(opacity=1); opacity: 0.01;"></div></div><div style="position: relative; overflow: hidden; width: 600px; height: 400px; text-align: left; line-height: normal; z-index: 0; user-select: none; outline: none; padding: 0px;" dir="ltr" class="highcharts-container " aria-hidden="false" tabindex="0"><div aria-hidden="false" class="highcharts-a11y-proxy-container-before" style="top: 0px; left: 0px; white-space: nowrap; position: absolute;"></div><svg version="1.1" class="highcharts-root" style="font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, sans-serif; font-size: 1rem;" xmlns="http://www.w3.org/2000/svg" width="600" height="400" viewBox="0 0 600 400" aria-hidden="false" aria-label="Interactive chart"><desc aria-hidden="true">Created with Highcharts x.y.z</desc><defs aria-hidden="true"><filter id="highcharts-drop-shadow-0"><feDropShadow dx="1" dy="1" flood-color="#000000" flood-opacity="0.75" stdDeviation="2.5"></feDropShadow></filter></defs><rect fill="#ffffff" class="highcharts-background" filter="none" x="0" y="0" width="600" height="400" rx="0" ry="0" aria-hidden="true"></rect><rect fill="none" class="highcharts-plot-background" x="10" y="10" width="580" height="375" filter="none" aria-hidden="true"></rect><rect fill="none" class="highcharts-plot-border" data-z-index="1" stroke="#cccccc" stroke-width="0" x="10" y="10" width="580" height="375" aria-hidden="true"></rect><g class="highcharts-series-group" data-z-index="3" filter="none" aria-hidden="true"></g><text x="300" class="highcharts-title" data-z-index="4" style="font-size: 1.2em; font-weight: bold; fill: #333333;" text-align="center" y="10" text-anchor="middle" transform-origin="10 4" transform="translate(0,0) scale(1 1)" aria-hidden="true">Chart title</text><text x="300" class="highcharts-subtitle" data-z-index="4" style="font-size: 0.8em; fill: #666666;" text-align="center" y="10" text-anchor="middle" transform-origin="10 3" transform="translate(0,0) scale(1 1)" aria-hidden="true"></text><text x="10" text-anchor="start" class="highcharts-caption" data-z-index="4" style="font-size: 0.8em; fill: #666666;" text-align="left" y="387" transform-origin="10 3" transform="translate(0,0) scale(1 1)" aria-hidden="true"></text><g class="highcharts-datalabels-group" data-z-index="6" aria-hidden="true"></g><g class="highcharts-legend highcharts-no-tooltip" data-z-index="7" visibility="hidden" aria-hidden="true"><rect fill="none" class="highcharts-legend-box" rx="0" ry="0" stroke="#999999" stroke-width="0" filter="none" x="0" y="0" width="8" height="8"></rect><g data-z-index="1"><g></g></g></g><text x="590" class="highcharts-credits" text-anchor="end" data-z-index="8" style="cursor: pointer; font-size: 0.6em; fill: #999999;" text-align="right" y="395" aria-label="Chart credits: Highcharts.com" aria-hidden="false">Highcharts.com</text></svg><div aria-hidden="false" class="highcharts-a11y-proxy-container-after" style="top: 0px; left: 0px; white-space: nowrap; position: absolute;"><div class="highcharts-a11y-proxy-group highcharts-a11y-proxy-group-zoom"></div><div class="highcharts-a11y-proxy-group highcharts-a11y-proxy-group-chartMenu"></div></div></div><div id="highcharts-screen-reader-region-after-0" style="position: relative;" aria-hidden="false"><div style="position: absolute; width: 1px; height: 1px; overflow: hidden; white-space: nowrap; clip: rect(1px, 1px, 1px, 1px); margin-top: -3px; filter: alpha(opacity=1); opacity: 0.01;" aria-hidden="false"><div id="highcharts-end-of-chart-marker-0" class="highcharts-exit-anchor" tabindex="0" aria-hidden="false">End of interactive chart.</div></div></div></div>"""
        )
      }
    }
  }
}
